(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{687:function(s,n,t){"use strict";t.r(n);var a=t(1),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("ul",[t("li",[s._v("hosts")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\tjenkins.chenio.com\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\tgitlab.chenio.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"gitlab-ce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ce"}},[s._v("#")]),s._v(" gitlab-ce")]),s._v(" "),t("ul",[t("li",[s._v("gitlab-ce for window")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local hosts add: 127.0.0.1  gitlab.chenio.com")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose.yml")]),s._v("\n\nversion: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\nservices:\n  web:\n    image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlab/gitlab-ce:latest'")]),s._v("\n    restart: always\n    hostname: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlab.chenio.com'")]),s._v("\n    environment:\n      GITLAB_OMNIBUS_CONFIG: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        external_url "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://gitlab.chenio.com:9090'")]),s._v("\n        gitlab_rails"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlab_shell_ssh_port'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2224")]),s._v("\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9090:9090'")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2224:22'")]),s._v("\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d:/docker/gitlab/config:/etc/gitlab'")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d:/docker/gitlab/logs:/var/log/gitlab'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# run docker-compose.yml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# windows10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --hostname localhost -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v(":80 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10443")]),s._v(":443 --name gitlab -v d:/docker/gitlab/config:/etc/gitlab -v d:/docker/gitlab/logs:/var/log/gitlab gitlab/gitlab-ce:latest\n\nhttp://localhost:10080/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("ul",[t("li",[s._v("gitlab-ce for Mac")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://docs.gitlab.com/omnibus/docker/#run-the-image")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --detach "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--hostname "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--publish "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":443 --publish "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v(":80 --publish "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":22 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--name gitlab "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--restart always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--volume /Users/pc/srv/gitlab/config:/etc/gitlab "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--volume /Users/pc/srv/gitlab/logs:/var/log/gitlab "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--volume /Users/pc/srv/gitlab/data:/var/opt/gitlab "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\tgitlab/gitlab-ce:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose.yml文件")]),s._v("\nweb:\n  image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlab/gitlab-ce:latest'")]),s._v("\n  restart: always\n  hostname: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlab.example.com'")]),s._v("\n  environment:\n    GITLAB_OMNIBUS_CONFIG: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n      external_url "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://gitlab.example.com:9090'")]),s._v("\n      gitlab_rails"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlab_shell_ssh_port'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2224")]),s._v("\n  ports:\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9090:9090'")]),s._v("\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2224:22'")]),s._v("\n  volumes:\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/pc/srv/gitlab/config:/etc/gitlab'")]),s._v("\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/pc/srv/gitlab/logs:/var/log/gitlab'")]),s._v("\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/pc/srv/gitlab/data:/var/opt/gitlab'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# run docker-compose.yml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" down\n\nhttp://localhost:9090\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("h2",{attrs:{id:"gitlab-runner"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-runner"}},[s._v("#")]),s._v(" gitlab-runner")]),s._v(" "),t("h3",{attrs:{id:"docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" docker")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# test rep")]),s._v("\nhttps://gitlab.com/chengzao/gitlab-test.git\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Windows下使用docker部署gitlab CI服务")]),s._v("\nhttps://www.jianshu.com/p/0abe441d5d3c\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker之CI/CD持续集成—GitLab CI服务器")]),s._v("\nhttps://zhuanlan.zhihu.com/p/54064430\nhttps://idig8.com/2018/11/20/987/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在docker中执行gitlab-runner")]),s._v("\nhttps://segmentfault.com/a/1190000012279248\n\nhttps://docs.gitlab.com/runner/\nhttps://docs.gitlab.com/runner/install/docker.html\nhttps://docs.gitlab.com/runner/register/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name gitlab-runner --restart always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /var/run/docker.sock:/var/run/docker.sock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /etc/gitlab-runner "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  gitlab/gitlab-runner:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# register")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it gitlab-runner gitlab-ci-multi-runner register\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm -t -i -v /Users/pc/srv/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# config")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\nalpine:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs gitlab-runner\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("h3",{attrs:{id:"docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" docker-compose")]),s._v(" "),t("ul",[t("li",[s._v("gitab-runner")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerfile")]),s._v("\nFROM gitlab/gitlab-runner:latest\n\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update -y\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/nodesource/distributions/blob/master/README.md")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sL https://deb.nodesource.com/setup_11.x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -\n\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nodejs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("docker-compose.yml")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\nservices:\n  web:\n    build: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'czh/gitlab-runner'")]),s._v("\n    restart: always\n    container_name: gitlab-runner\n    extra_hosts:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitlab.chenio.com:192.168.137.138"')]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jenkins.chenio.com:192.168.137.138"')]),s._v("\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/var/run/docker.sock:/var/run/docker.sock'")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/pc/srv/gitlab-runner/config:/etc/gitlab-runner'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[t("p",[t("code",[s._v('docker-compose -f "docker-compose.yml" up -d --build')])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("docker exec -it gitlab-runner gitlab-ci-multi-runner register")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step1: Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):")]),s._v("\nhttp://gitlab.chenio.com:9090/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step2: Please enter the gitlab-ci token for this runner:")]),s._v("\nraQ5xxxxxxxxxxxxWQ\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step3: Please enter the gitlab-ci description for this runner:")]),s._v("\nrunner-name\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step4: Please enter the gitlab-ci tags for this runner (comma separated):")]),s._v("\ntest, build, deploy\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step5: Please enter the executor: parallels, shell, ssh, virtualbox, docker+machine, docker-ssh+machine, docker, docker-ssh, kubernetes:")]),s._v("\nshell\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("gitlab-ci.yml")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file is a template, and might need editing before it works on your project.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# see https://docs.gitlab.com/ce/ci/yaml/README.html for all available options")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# react simple demo")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# you can delete this line if you're not using Docker")]),s._v("\nimage: node:latest\n\nbefore_script:\n  - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Before script installing package"')]),s._v("\n  - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" -v\n  - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" -v\n  - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\nafter_script:\n  - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"After script section"')]),s._v("\n\nbuild:\n  stage: build\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n\ntest:\n  stage: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\ndeploy:\n  stage: deploy\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Do your deploy here"')]),s._v("\n\ncache:\n  paths:\n  - node_modules/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("h3",{attrs:{id:"windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[s._v("#")]),s._v(" windows")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runner安装下载")]),s._v("\nhttps://docs.gitlab.com/runner/install/windows.html\n- C盘新建GitLab-Runner文件夹\n- 将下载好的文件exe文件放进GitLab-Runner， 重命名为gitlab-runner.exe\n- Windows PowerShell Run as administrator\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注册")]),s._v("\nhttps://docs.gitlab.com/runner/register/index.html\n- ./gitlab-runner.exe register\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install the Runner as a service and start it")]),s._v("\n- gitlab-runner "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n- gitlab-runner start\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# stop")]),s._v("\n- "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("GitLab-Runner\n- gitlab-runner stop\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# update")]),s._v("\n- "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("GitLab-Runner\n- gitlab-runner stop\n- 重复runner安装下载\n- gitlab-runner start\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Uninstall")]),s._v("\n- "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("GitLab-Runner\n- gitlab-runner stop\n- gitlab-runner uninstall\n- "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rmdir")]),s._v(" /s GitLab-Runner\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h2",{attrs:{id:"jenkins-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-docker"}},[s._v("#")]),s._v(" jenkins docker")]),s._v(" "),t("ul",[t("li",[s._v("jenkins for mac")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/jenkinsci/docker/blob/master/README.md")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull jenkins/jenkins:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":50000 --name devops-jenkins -v /Users/pc/srv/jenkins_home:/var/jenkins_home jenkins/jenkins:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs devops-jenkins\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("jenkins for windows")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/jenkinsci/docker/blob/master/README.md")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull jenkins/jenkins:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":50000 --name devops-jenkins -v d:/docker/jenkins_home:/var/jenkins_home jenkins/jenkins:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始密码位置")]),s._v("\nD:/docker/jenkins_home/secrets/initialAdminPassword\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local hosts add: 127.0.0.1  jenkins.chenio.com")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"jenkins-docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-docker-compose"}},[s._v("#")]),s._v(" jenkins docker-compose")]),s._v(" "),t("h3",{attrs:{id:"jenkins-for-mac"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-for-mac"}},[s._v("#")]),s._v(" jenkins for mac")]),s._v(" "),t("ul",[t("li",[s._v("docker-compose.yml")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose.yml")]),s._v("\nversion: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\nservices:\n  web:\n    image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins/jenkins:latest'")]),s._v("\n    restart: always\n    hostname: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins.chenio.com'")]),s._v("\n    pid: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v("\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8080:8080'")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'50000:50000'")]),s._v("\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/Users/pc/srv/jenkins_home:/var/jenkins_home'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("运行：docker-compose up -d")])]),s._v(" "),t("h3",{attrs:{id:"jenkins-for-windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-for-windows"}},[s._v("#")]),s._v(" jenkins for windows")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("docker-compose.yml")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local hosts add: 127.0.0.1  jenkins.chenio.com")]),s._v("\nversion: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\nservices:\n  web:\n    image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins/jenkins:latest'")]),s._v("\n    restart: always\n    hostname: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins.chenio.com'")]),s._v("\n    pid: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v("\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8080:8080'")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'50000:50000'")]),s._v("\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d:/docker/jenkins_home:/var/jenkins_home'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("运行：docker-compose up -d")])]),s._v(" "),t("h2",{attrs:{id:"gitlab-ci"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci"}},[s._v("#")]),s._v(" GitLab-CI")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Configuration of your jobs with .gitlab-ci.yml"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/kunyus/article/details/81390330",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文：Gitlab-CI job 配置文件 .gitlab-ci.yml 配置方式(翻译)"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("gitlab-ci 使用 YAML 文件管理配置 job")]),s._v(" "),t("li",[s._v("Job: YAML 文件定义了一系列带有约束说明的 job, job "),t("strong",[s._v("至少")]),s._v("需要要包含 script\n"),t("ul",[t("li",[s._v("script 可以直接执行系统命令(如：./configure;make;make install)或者直接执行脚本(test.sh)")]),s._v(" "),t("li",[s._v("任务是由 CI 接管并且在服务器执行, 并且"),t("strong",[s._v("每一个任务的执行都是独立的")])])])]),s._v(" "),t("li",[s._v("job 的名称具有"),t("strong",[s._v("唯一性")]),s._v("在文件中只能出现一次; 下列词汇是"),t("strong",[s._v("保留字段，不能被使用")]),s._v("命名为 job 名称")]),s._v(" "),t("li",[s._v("关键字: 不可以被用于 Job 名 的保留字")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("关键字")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("是否必须")]),s._v(" "),t("th",[s._v("描述")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("image")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("用于 docker 镜像")])]),s._v(" "),t("tr",[t("td",[s._v("services")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("用于 docker 服务")])]),s._v(" "),t("tr",[t("td",[s._v("stages")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("定义构建阶段")])]),s._v(" "),t("tr",[t("td",[s._v("types")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("stages 的别名(已废除)")])]),s._v(" "),t("tr",[t("td",[s._v("before_script")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("定义在每个 job 之前运行的命令")])]),s._v(" "),t("tr",[t("td",[s._v("after_script")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("定义在每个 job 之后运行的命令")])]),s._v(" "),t("tr",[t("td",[s._v("variables")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("定义构建变量")])]),s._v(" "),t("tr",[t("td",[s._v("cache")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",[s._v("定义一组文件列表，可在后续运行中使用")])])])]),s._v(" "),t("ul",[t("li",[s._v("only and except 保留字")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("关键字")]),s._v(" "),t("th",[s._v("描述")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("branches")]),s._v(" "),t("td",[s._v("当一个分支被 push 上来")])]),s._v(" "),t("tr",[t("td",[s._v("tags")]),s._v(" "),t("td",[s._v("当一个打了 tag 的分支被 push 上来")])]),s._v(" "),t("tr",[t("td",[s._v("api")]),s._v(" "),t("td",[s._v("当一个 pipline 被 piplines api 所触发调起")])]),s._v(" "),t("tr",[t("td",[s._v("external")]),s._v(" "),t("td",[s._v("当使用了 GitLab 以外的 CI 服务")])]),s._v(" "),t("tr",[t("td",[s._v("pipelines")]),s._v(" "),t("td",[s._v("针对多项目触发器而言，当使用 CI_JOB_TOKEN 并使用 gitlab 所提供的 api 创建多个 pipelines 的时候")])]),s._v(" "),t("tr",[t("td",[s._v("pushes")]),s._v(" "),t("td",[s._v("当 pipeline 被用户的 git push 操作所触发的时候")])]),s._v(" "),t("tr",[t("td",[s._v("schedules")]),s._v(" "),t("td",[s._v("针对预定好的 pipline 而言（每日构建一类）")])]),s._v(" "),t("tr",[t("td",[s._v("triggers")]),s._v(" "),t("td",[s._v("用 token 创建 piplines 的时候")])]),s._v(" "),t("tr",[t("td",[s._v("web")]),s._v(" "),t("td",[s._v("在 GitLab 页面上 Pipelines 标签页下，你按了 run pipline 的时候")])])])]),s._v(" "),t("ul",[t("li",[s._v("job 可以配置的参数列表")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("参数名称")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("是否必须")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("参数说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("script")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("yes")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("需要在 docker 容器中运行的脚本")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("image")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("所使用的 docker 镜像")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("services")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("需要关联的 docker 服务")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("stage")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义当前 job 运行在那个阶段 (默认: test)")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("variables")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义 job 级别的变量")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("only")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义一列 git 分支，并为其创建 job")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("except")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义一列 git 分支，不创建 job")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("tags")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("通过 tags 确定使用指定还是使用通用部署程序")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("allow_failure")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("允许 job 失败， job 失败不会影响最终结果")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("when")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义 job 在什么时候运行， 支持参数 on_success, on_failure, always 或者 manual")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("dependencies")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义 job 依赖关系，这样他们就可以互相传递 artifacts")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("artifacts")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("Define list of job artifacts")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("cache")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义应在后续运行之间缓存的文件列表")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("before_script")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("覆盖 job 执行前需要执行的脚本设置")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("after_script")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("覆盖 job 执行后需要执行的脚本设置")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("environment")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义此作业完成部署的环境名称")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("coverage")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("定义给定作业的代码覆盖率设置")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("retry")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("no")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("job 执行发生故障时自动重试次数")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# job示例")]),s._v("\n\nimage: ruby:2.1\nservices:\n  - postgres\n\nbefore_script:\n  - bundle "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\nafter_script:\n  - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" secrets\n\nstages:\n  - build\n  - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  - deploy\n\njob1:\n  stage: build\n  script:\n    - execute-script-for-job1\n  only:\n    - master\n  tags:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("ul",[t("li",[s._v("image and services: 这两个关键字允许使用一个自定义的 Docker 镜像和一系列的服务，并且可以用于整个 job 周期")]),s._v(" "),t("li",[s._v("before_script:\n"),t("ul",[t("li",[s._v("必须是数组或多行字符串")]),s._v(" "),t("li",[s._v("支持定义为 global 和 job 类型， job 类型会覆盖掉 global 类型的值")]),s._v(" "),t("li",[s._v("定义在所有 job（包括 deploy job）之前运行的命令。（在 "),t("em",[s._v("artifacts")]),s._v(" 运行之后）")])])]),s._v(" "),t("li",[s._v("after_script\n"),t("ul",[t("li",[s._v("必须是数组或多行字符串")]),s._v(" "),t("li",[s._v("支持定义为 global 和 job 类型， job 类型会覆盖掉 global 类型的值")]),s._v(" "),t("li",[s._v("定义在所有 job（包括失败的 job）之后运行的命令")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# script示例")]),s._v("\n\nbefore_script:\n  - global before script\n\njob:\n  before_script:\n    - execute this instead of global before script\n  script:\n    - my "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\n  after_script:\n    - execute this after my script\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("stages\n"),t("ul",[t("li",[s._v("只支持 global 类型")]),s._v(" "),t("li",[s._v("定义了 job 支持的执行阶段和顺序")]),s._v(" "),t("li",[s._v("stages 中的元素顺序决定了对应 job 的执行顺序")]),s._v(" "),t("li",[s._v("下一个 阶段 的 job 只会在前一个 阶段 的 job 执行成功后开始执行")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# stages示例")]),s._v("\nstages:\n  - build\n  - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  - deploy\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行顺序：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 运行所有的 build\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". 如果所有作业都 build 运行成功，那么开始运行所有的 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". 如果所有作业都 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" 运行成功，那么开始运行所有的 deploy\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(". 如果所有作业都 deploy 成功，则标记 job 为 passed\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(". 如果在之前动作中有任何失败，则标记 job 为 failed 并终止 job 执行\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有定义stages时的默认动作")]),s._v("\n如果 .gitlab-ci.yml 文件中没有定义 stages , stages 将会被设置成 build -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" deploy.\n如果 job 没有定义 stage, 则 job 的 stage 将会被设置成 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("ul",[t("li",[s._v("stage\n"),t("ul",[t("li",[s._v("相同 stage 的 job 会并行执行")]),s._v(" "),t("li",[s._v("stage 的值必须定义在 stages 中，可以通过设置 stage 来对 job 进行分组，相同分组的 job 将会并行执行.")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# stage示例")]),s._v("\nstages:\n  - build\n  - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  - deploy\n\njob "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":\n  stage: build\n  script: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" build dependencies\n\njob "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":\n  stage: build\n  script: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" build artifacts\n\njob "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":\n  stage: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  script: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\njob "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":\n  stage: deploy\n  script: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" deploy\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("script\n"),t("ul",[t("li",[s._v("script 是 job 运行需要的唯一一个必须字段, 通过 script 来指定应该如何执行 job")]),s._v(" "),t("li",[s._v("script 可以设置为 string 和 array 类型")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# script 设置为 string 来设置 job 执行什么命令")]),s._v("\njob:\n  script: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bundle exec rspec"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# script 设置为 array 来指定运行多个命令")]),s._v("\njob:\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -a\n    - bundle "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" rspec\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果命令中包含有特殊字符, 则需要用双引号将 script 括起来")]),s._v("\njob:\nscript:\n  - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n  - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ps -aux | grep gcc"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("YAML 中的特殊字符:\n"),t("code",[s._v(":")]),s._v(" 、 "),t("code",[s._v("{")]),s._v(" 、 "),t("code",[s._v("}")]),s._v(" 、 "),t("code",[s._v("[")]),s._v(" 、 "),t("code",[s._v("]")]),s._v(" 、"),t("code",[s._v(",")]),s._v(" 、 "),t("code",[s._v("&")]),s._v(" 、 "),t("code",[s._v("*")]),s._v(" 、 "),t("code",[s._v("#")]),s._v(" 、 "),t("code",[s._v("?")]),s._v(" 、 "),t("code",[s._v("|")]),s._v(" 、 "),t("code",[s._v("-")]),s._v(" 、 "),t("code",[s._v("<")]),s._v(" 、 "),t("code",[s._v(">")]),s._v(" 、 "),t("code",[s._v("=")]),s._v(" 、 "),t("code",[s._v("!")]),s._v(" 、 "),t("code",[s._v("%")]),s._v(" 、"),t("code",[s._v("@")]),s._v(" 、`` ` 。")])]),s._v(" "),t("li",[t("p",[s._v("only and except")]),s._v(" "),t("ul",[t("li",[s._v("只有满足 only 条件的 branches 和 tags 才会被运行")]),s._v(" "),t("li",[s._v("except 和 only 相反, 满足 except 条件的 branches 和 tags 将 不会 被运行")])])]),s._v(" "),t("li",[t("p",[s._v("refs 策略的使用规则:")]),s._v(" "),t("ul",[t("li",[s._v("only 和 except 支持使用正则表达式.")]),s._v(" "),t("li",[s._v("only 和 except 支持使用特殊的关键字.")]),s._v(" "),t("li",[s._v("only 和 except 支持同时设置, 当同时设置时 only 和 except 将会同时起作用.")]),s._v(" "),t("li",[s._v("only 和 except 也可以用来指定 forks 作业的存储库路径")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# job 会跳过所有分支, 只在以 issue- 开头的 ref 时运行")]),s._v("\n\njob:\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use regexp")]),s._v("\n  only:\n    - /^issue-.*$/\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use special keyword")]),s._v("\n  except:\n    - branches\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# job 只会执行有 tags 或者通过API触发器构建的 refs")]),s._v("\n\njob:\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use special keywords")]),s._v("\n  only:\n    - tags\n    - triggers\n    - schedules\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只会在除 gitlab-org/gitlab-ce 的 master 分支外的其他分支时才会运行")]),s._v("\n\njob:\n  only:\n    - branches@gitlab-org/gitlab-ce\n  except:\n    - master@gitlab-org/gitlab-ce\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("ul",[t("li",[s._v("artifacts:\n"),t("ul",[t("li",[s._v("用于指定成功后应附加到 job 的文件和目录的列表")]),s._v(" "),t("li",[s._v("只能使用项目工作间内的文件或目录路径")]),s._v(" "),t("li",[s._v("定义一个空的 dependencies 数组可以禁用 artifact 传递")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# artifacts示例")]),s._v("\njob:\n  stage: build\n  script: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" build\n  dependencies: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("variables: GitLab CI 允许你为.gitlab-ci.yml 增加变量，该变量将会被设置入任务环境")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变量")]),s._v("\n\nvariables:\n    DATABASE_URL: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"postgres://postgres@postgres/my_database"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意:整数和字符串一样，对于设置变量名和变量值来说都是合法的。但浮点数是非法的。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("tags：用来确定使用哪个 runner 运行当前任务，如果不设置的话将使用通用 runner 运行")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只有同时定义了 ruby 和 postgres 的 runner 才能运行这个 job")]),s._v("\n\njob:\n  tags:\n    - ruby\n    - postgres\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("allow_failure: 允许 job 失败. job 失败不会影响最终结果")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  当 job1 运行失败, 也不会打断 CI 执行，CI 会继续运行下一阶段")]),s._v("\n\njob1:\n  stage: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  script:\n    - execute_script_that_will_fail\n  allow_failure: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\njob2:\n  stage: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  script:\n    - execute_script_that_will_succeed\n\njob3:\n  stage: deploy\n  script:\n    - deploy_to_staging\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("ul",[t("li",[s._v("when 用来指示 job 应该在什么时候开始运行\n"),t("ul",[t("li",[s._v("on_success - 只有之前的阶段全部成功时才会执行.(默认值)")]),s._v(" "),t("li",[s._v("on_failure - 当之前的阶段执行过程中出现过任何错误时执行")]),s._v(" "),t("li",[s._v("always - 无论之前的阶段是否执行成功都执行")]),s._v(" "),t("li",[s._v("manual - 手动执行")])])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("stages:\n  - build\n  - cleanup_build\n  - "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  - deploy\n  - cleanup\n\nbuild_job:\n  stage: build\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" build\n\ncleanup_build_job:\n  stage: cleanup_build\n  script:\n    - cleanup build when failed\n  when: on_failure\n\ntest_job:\n  stage: "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\ndeploy_job:\n  stage: deploy\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" deploy\n  when: manual\n\ncleanup_job:\n  stage: cleanup\n  script:\n    - cleanup after "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("jobs")]),s._v("\n  when: always\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 cleanup_build_job 只有在 build_job 失败时才会执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 不论其他 job 是否执行成功, cleanup_job 总会在最后一个被执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3 可以通过 Gitlab 控制台手动执行 deploy_job")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("ul",[t("li",[t("a",{attrs:{href:"https://zacksleo.github.io/2017/04/18/GitLab-CI%E4%B8%AD%E7%9A%84artifacts%E4%BD%BF%E7%94%A8%E7%A0%94%E7%A9%B6/",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitLab-CI 中的 artifacts 使用研究"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=e.exports}}]);