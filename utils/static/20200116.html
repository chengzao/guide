<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      function Person(name) {
        this.name = name;
      }

      Person.prototype.say = function() {
        console.log("name", this.name);
      };

      // var p = new Person('xxx')
      // console.log(p.__proto__)

      // Function.prototype._bind = function(context) {
      //   let fn = this;
      //   let args = [...arguments].slice(1);
      //   let Nop = function() {};
      //   let bound = function() {
      //     args = args.concat([...arguments]);
      //     return fn.apply(this instanceof Nop ? this : context, args);
      //   };
      //   Nop.prototype = fn.prototype;
      //   Nop.prototype.constructor = Nop;
      //   bound.prototype = new Nop();
      //   return bound;
      // };
      Function.prototype._bind = function(obj) {
        let fn = this;
        let args = [...arguments].slice(1);
        let Nop = function() {};
        let bound = function(...arg) {
          args = args.concat(arg);

          return fn.apply(this instanceof Nop ? this : obj, args);
        };

        Nop.prototype = fn.prototype;
        bound.prototype = new Nop();
        return bound;
      };

      Function.prototype._call = function(context) {
        context.fn = this;
        let args = [...arguments].slice(1);
        let result = context.fn(...args);
        delete context.fn;
        return result;
      };

      Function.prototype._apply = function(context) {
        context.fn = this;

        let result;
        if (arguments[1]) {
          result = context.fn(...arguments[1]);
        } else {
          result = context.fn();
        }
        delete context.fn;
        return result;
      };

      function _new() {
        let [fn, ...args] = [...arguments];
        let obj = Object.create(fn.prototype);
        let result = fn.apply(obj, args);
        if (typeof result === "function" || typeof result === "object") {
          return result;
        }
        return obj;
      }

      function create(proto) {
        function F() {}
        F.prototype = proto;
        F.prototype.constructor = F;
        return new F();
      }

      function fe(a, b, c) {
        return a + b + c;
      }

      function curry(fe) {
        let args = []; // 参数集合
        let len = args.length;
        return function bar() {
          args = [...args, ...arguments]; // 收集参数
          if (args.length >= fe.length) {
            return fe.apply(this, args);
          }
          return bar;
        };
      }

      console.log(curry(fe)(1)(2)(3)); // 6

      // function thousandth(str) {
      //   return str.replace(/\d(?=(?:\d{3})+(?:\.\d+|$))/g, "$&,");
      // }

      function quickSort(arr) {
        if (arr.length <= 1) {
          return arr;
        }

        let pivot = arr[0];

        let left = arr.filter(item => item < pivot);
        let right = arr.filter(item => item > pivot);

        return quickSort(left).concat(pivot, quickSort(right));
      }

      // function foo(a, b) {
      //   console.log(a,b)
      //   return this;
      // }
      // var obj = {
      //   b: 200,
      //   a: 1
      // }
      // let fe = foo._bind(obj);
      // console.log(fe()); //
      // console.log(new fe()); // 实例 {b: 100}
      // let fe = foo._call(obj);
      // console.log(fe)

      // let fe = foo._apply(obj,[1,2]);
      // console.log(fe)

      // function isObject(params) {
      //   return typeof params === "object" && params !== null;
      // }

      // function deepClone(obj, map = new WeakMap()) {

      //   if (obj instanceof RegExp) return new RegExp(obj);
      //   if (obj instanceof Date) return new Date(obj);

      //   if (obj == null || typeof obj != 'object') return obj;

      //   var t = {}
      //   if(map.has(obj)){
      //     return map.get(obj);
      //   }

      //   map.set(obj, t)
      //   for(var key in obj){
      //     if(Object.prototype.hasOwnProperty(obj, key)){
      //       t[key] =  deepClone(obj[key], map)
      //     }
      //   }
      //   return t;
      // }

      // function deepClone(obj, map = new WeakMap()) {
      //     if (obj instanceof RegExp) return new RegExp(obj);
      //     if (obj instanceof Date) return new Date(obj);
      //     // 判断是否是一个非对象
      //     if (obj == null || typeof obj != 'object') return obj;

      //     if (map.has(obj)) {
      //         return map.get(obj);
      //     }
      //     let t = new obj.constructor();
      //     map.set(obj, t);
      //     for (let key in obj) {
      //         if (obj.hasOwnProperty(key)) {
      //             t[key] = deepClone(obj[key], map);
      //         }
      //     }
      //     return t;
      // }

      function deepClone(obj, map = new WeakMap()) {
        if (obj instanceof RegExp) return new RegExp(obj);
        if (obj instanceof Date) return new Date(obj);

        if (typeof obj != "object" || obj == null) {
          return obj;
        }

        if (map.has(obj)) {
          return map.get(obj);
        }
        let t = new obj.constructor();
        map.set(obj, t);
        for (let key in obj) {
          if (obj.hasOwnProperty(key)) {
            t[key] = deepClone(obj[key], map);
          }
        }
        return t;
      }

      //测试用例
      var obj = {
        a: 1,
        b: {
          c: 2,
          d: 3
        },
        d: new RegExp(/^\s+|\s$/g)
      };
      obj.b.e = obj.b;

      let clone_obj = deepClone(obj);
      obj.d = /^\s|[0-9]+$/g;
      // console.log('clone',clone_obj)
      // console.log('old',obj)

      function minstanceof(left, right) {
        if (typeof l != "object" || l == null) return false;
        let l = left.__proto__,
          r = right.prototype;
        while (true) {
          if (l == null) {
            return false;
          }
          if (l == r) {
            return true;
          }
          l = l.__proto__;
        }
      }

      function throttle(fn, wait) {
        let last = 0;
        return function(...args) {
          let now = Date.now();
          if (now - last > wait) {
            fn.apply(this, args);
            last = now;
          }
        };
      }

      function debounce(fn, wait, immediate) {
        let timer = null;

        return function(...args) {
          const that = this;
          if (timer) {
            clearTimeout(timer);
          }

          if (immediate) {
            callNow = !timer;
            timer = setTimeout(() => {
              timer = null;
            }, wait);
            if (callNow) fn.apply(that, args);
          }

          timer = setTimeout(() => {
            fn.apply(that, args);
          }, wait);
        };
      }

      // 如 balance('[()') = false; balance('[()()()]') = true
      // 一

      function match(a, b) {
        return (
          (a === "(" && b === ")") ||
          (a === ")" && b === "(") ||
          (a === "[" && b === "]") ||
          (a === "]" && b === "[")
        );
      }

      function is_balance(str) {
        return (
          [...str].reduce((stack, c) => {
            match(stack[stack.length - 1], c) ? stack.pop() : stack.push(c);
            return stack;
          }, []).length === 0
        );
      }


    </script>
  </body>
</html>
