<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 实现Promise.all 以及 race
      Promise.myall = function(arr) {
        return new Promise((resolve, reject) => {
          if (arr.length === 0) {
            return resolve([]);
          } else {
            let res = [],
              count = 0;
            for (let i = 0; i < arr.length; i++) {
              // 同时也能处理arr数组中非Promise对象
              if (!(arr[i] instanceof Promise)) {
                res[i] = arr[i];
                if (++count === arr.length) resolve(res);
              } else {
                arr[i].then(
                  data => {
                    res[i] = data;
                    if (++count === arr.length) resolve(res);
                  },
                  err => {
                    reject(err);
                  }
                );
              }
            }
          }
        });
      };

      Promise.myrace = function(arr) {
        return new Promise((resolve, reject) => {
          for (let i = 0; i < arr.length; i++) {
            // 同时也能处理arr数组中非Promise对象
            if (!(arr[i] instanceof Promise)) {
              Promise.resolve(arr[i]).then(resolve, reject);
            } else {
              arr[i].then(resolve, reject);
            }
          }
        });
      };

      function Promise2(callback) {
        this.status = "pending";
        this.data = null;
        this.reason = null;
        this.resolveCb = [];
        this.rejectCb = [];

        function resolve(data) {
          if (this.status === "pending") {
            this.data = data;
            this.status = "fulfilled";
            this.resolveCb.forEach(cb => cb(data));
          }
        }

        function reject(reason) {
          if (this.status === "pending") {
            this.reason = reason;
            this.status = "rejected";
            this.rejectCb.forEach(cb => cb(reason));
          }
        }

        try {
          callback(resolve, reject);
        } catch (error) {
          reject(error);
        }
      }

      Promise2.prototype.then = function(onResolve, onReject) {
        if (this.status == "fulfilled") {
          onResolve(this.data);
        }

        if (this.status == "rejected") {
          onReject(this.reason);
        }
        if (this.status == "pending") {
          this.resolveCb.push(() => onResolve(this.data));
          this.rejectCb.push(() => onReject(this.reason));
        }
      };

      Promise2.prototype.all = function(arr) {
        return new Promise2((resolve, reject) => {
          let result = [];
          let count = 0;
          arr.forEach((p, i) => {
            p.then(res => {
              result[i] = res;
              count++;
              if (count === arr.length) {
                resolve(values);
              }
            }).catch(reject);
          });
        });
      };

      function requestPools(tasks, max = 5) {
        let result = [];

        let pools = new Array(max).fill(null);
        let index = 0;

        pools.map(pol => {
          return new Promise((resolve, reject) => {
            let next = function name(params) {
              if (index >= tasks.length) {
                resolve(result);
                return;
              }
              let old = index;
              let task = task[index++];
              task()
                .then(res => {
                  result[old] = res;
                  next();
                })
                .catch(err => reject(err));
            };

            next();
          });
        });

        return Promise.all(pools).then(() => result);
      }

      function quickSort(arr) {
        if (arr.length <= 1) return arr;
        let mid = arr[0];

        let left = arr.filter(item => item < mid);
        let right = arr.filter(item => item > mid);

        return quickSort(left).concat(mid, quickSort(right));
      }

      const array1 = [5, 4, 30, 2, 1, 9, 100, 23];
      console.log("quickSort ", quickSort(array1));

      function selectionSort(arr) {
        if (arr.length <= 1) return arr;
        let len = arr.length;
        let minIndex, temp;
        for (let i = 0; i < len - 1; i++) {
          minIndex = i;
          for (let j = i + 1; j < len; j++) {
            if (arr[j] < arr[minIndex]) {
              minIndex = j;
            }
          }
          // temp = arr[i];
          // arr[i] = arr[minIndex];
          // arr[minIndex] = temp;
          [arr[i], arr[minIndex]] = [arr[minIndex], arr[i]]
        }
        return arr;
      }
      // const selectionSort = array => {
      //   const len = array.length;
      //   let minIndex, temp;
      //   for (let i = 0; i < len - 1; i++) {
      //     minIndex = i;
      //     for (let j = i + 1; j < len; j++) {
      //       if (array[j] < array[minIndex]) {
      //         // 寻找最小的数
      //         minIndex = j; // 将最小数的索引保存
      //       }
      //     }
      //     temp = array[i];
      //     array[i] = array[minIndex];
      //     array[minIndex] = temp;
      //     console.log("array: ", array);
      //   }
      //   return array;
      // };

      console.log("selectionSort ", selectionSort(array1));

      function bubbleSort(arr) {
        const length = arr.length;
        if (length <= 1) return;
        // 是否有序
        let isSort = true;
        // 记录最后交换索引
        let lastChangeIndex = 0;
        let sortBorder = arr.length - 1;
        for (let i = 0; i < length - 1; i++) {
          for (let j = 0; j < sortBorder; j++) {
            if (arr[j] > arr[j + 1]) {
              [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
              isSort = false;
              lastChangeIndex = j;
            }
          }
          sortBorder = lastChangeIndex;
          if (isSort) {
            break;
          }
        }
        return arr;
      }

      var arr = [3, 44, 38, 5, 47, 15, 36, 26, 27, 2, 46, 4, 19, 50, 48];
      console.log(bubbleSort(arr));

    </script>
  </body>
</html>
